# 実装計画ファイル: バックエンド計算処理API実装

## 実装チェックリスト

### 1. 型定義の作成
- [ ] `lib/types/simulation.ts` ファイルを作成
- [ ] `SimulationRequest` インターフェイスを定義
- [ ] `SimulationResult` インターフェイスを定義  
- [ ] `SimulationResponse` インターフェイスを定義

### 2. バリデーション機能の実装
- [ ] `lib/validators/simulation.ts` ファイルを作成
- [ ] 必須フィールドのチェック関数を実装
- [ ] 数値の型チェック関数を実装
- [ ] 数値の範囲チェック（0以上）を実装
- [ ] 文字列の選択肢チェック（interestType, depositFrequency, taxTiming）を実装
- [ ] 統合バリデーション関数 `validateSimulationRequest` を実装

### 3. 計算サービスの実装
- [ ] `lib/services/simulation-calculator.ts` ファイルを作成
- [ ] 既存のフロントエンド計算ロジックをコピー
- [ ] TypeScript型定義に合わせてリファクタリング
- [ ] 年間積立額の計算ロジックを実装
- [ ] 複利計算ロジックを実装
- [ ] 単利計算ロジックを実装
- [ ] 税金計算ロジック（年次/満期）を実装
- [ ] 手数料計算ロジックを実装
- [ ] 統合計算関数 `calculateSimulation` を実装

### 4. API Routeの実装
- [ ] `app/api/calculate-simulation/route.ts` ファイルを作成
- [ ] POST メソッドハンドラーを実装
- [ ] リクエストボディの取得処理を実装
- [ ] バリデーション呼び出しを実装
- [ ] 計算サービス呼び出しを実装
- [ ] 成功レスポンス（200）を実装
- [ ] エラーレスポンス（400/500）を実装
- [ ] エラーハンドリングを実装

### 5. フロントエンドの修正
- [ ] `app/page.tsx` の `calculateSimulation` 関数をバックアップ
- [ ] API呼び出しに変更（fetch使用）
- [ ] リクエストボディの構築を実装
- [ ] レスポンス処理を実装
- [ ] エラーハンドリングを追加
- [ ] ローディング状態管理は既存のまま維持

### 6. テストの実装
- [ ] バリデーション関数の単体テストを作成
- [ ] 計算ロジックの単体テストを作成
- [ ] API Routeの統合テストを作成
- [ ] エッジケースのテストを追加

### 7. 動作確認
- [ ] 開発サーバーを起動
- [ ] 基本的な計算が正常に動作することを確認
- [ ] 複利計算が正常に動作することを確認
- [ ] 単利計算が正常に動作することを確認
- [ ] 定期積立ありの計算を確認
- [ ] 税金計算（年次）を確認
- [ ] 税金計算（満期）を確認
- [ ] エラー時の動作を確認
- [ ] 既存の計算結果と同じ値が返ることを確認

### 8. リファクタリング・最適化
- [ ] 不要なコードの削除
- [ ] コメントの追加（必要に応じて）
- [ ] パフォーマンスの最適化（必要に応じて）

## 実装順序
1. 型定義 → 2. バリデーション → 3. 計算サービス → 4. API Route → 5. フロントエンド修正 → 6. テスト → 7. 動作確認 → 8. リファクタリング