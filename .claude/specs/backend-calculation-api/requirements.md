# 要件ファイル: バックエンド計算処理API実装

## 1. 概要
現在フロントエンド（クライアントサイド）で実行されている投資シミュレーションの計算処理を、Next.jsのAPI Routesを使用してバックエンド側に移管する。

## 2. 機能要件

### 2.1 API エンドポイント
- **エンドポイントパス**: `/api/calculate-simulation`
- **HTTPメソッド**: POST
- **レスポンス形式**: JSON

### 2.2 リクエストパラメーター
以下のパラメーターを受け取る必要がある：

#### 基本設定
- `principal`: 元本金額（数値）
- `interestType`: 運用方式（"compound" | "simple"）
- `annualRate`: 年利率（%、数値）
- `years`: 運用年数（数値）

#### 定期積立設定
- `depositAmount`: 積立額（数値）
- `depositFrequency`: 積立頻度（"none" | "monthly" | "yearly"）

#### 税金・手数料設定
- `taxRate`: 税率（%、数値）
- `taxTiming`: 課税タイミング（"annual" | "maturity"）
- `managementFee`: 運用手数料（年率%、数値）
- `tradingFee`: 売買手数料（円、数値）

### 2.3 レスポンスデータ
年度ごとの以下の情報を配列で返す：
- `year`: 年度
- `principal`: 元本
- `deposit`: 積立額
- `interest`: 運用益
- `tax`: 税金
- `fee`: 手数料
- `balance`: 残高

### 2.4 エラーハンドリング
- 必須パラメーターの不足時は400エラー
- 不正な値（負の数値など）の場合は400エラー
- サーバーエラー時は500エラー
- エラーメッセージは日本語で返す

## 3. 非機能要件

### 3.1 パフォーマンス
- レスポンス時間: 1秒以内
- 同時リクエスト処理: 100リクエスト/秒に対応

### 3.2 セキュリティ
- 入力値の検証を実施
- 数値の上限・下限チェック
- SQLインジェクション等の攻撃への対策（今回はDBアクセスなし）

### 3.3 保守性
- 計算ロジックを独立したモジュールとして分離
- TypeScriptの型定義を活用
- エラーハンドリングの統一

## 4. 制約事項
- Next.js 15のApp RouterのAPI Routes機能を使用
- TypeScriptを使用
- 既存のフロントエンドコードとの互換性を維持
- 計算ロジックは既存の実装と同じ結果を返す

## 5. 移行要件
- フロントエンドのcalculateSimulation関数をAPI呼び出しに変更
- ローディング状態の管理は既存のものを維持
- エラー時のユーザーへのフィードバック機能を追加